<?php

require_once __DIR__ . '/vendor/autoload.php';
require_once __DIR__ . '/src/CVEBot/Config.php';

// Load each of the plugins
$plugins = array_map(
    function ($name) {
        require_once __DIR__ . "/src/CVEBot/Plugin/$name.php";

        $className = "CVEBot\Plugin\\$name";
        return new $className();
    },
    array(
        'PongPlugin',
        'QuitPlugin',
        'RehashPlugin',
        'CvePlugin',
        'CtcpTimePlugin',
        'CtcpVersionPlugin',
        'AutoJoinPlugin'
    )
);

$config = CVEBot\Config::getInstance()->getData();

use Phergie\Irc\Connection;

$options = $config['irc']['ssl']
    ? array('transport' => 'ssl')
    : array();

return array(
    'connections' => array(
        new Connection(array(
            'serverHostname' => $config['irc']['server'],
            'nickname' => $config['irc']['nick'],
            'username' => $config['irc']['nick'],
            'realname' => $config['irc']['nick'],
            'serverport' => $config['irc']['port'],
            'options' => $options
        ))
    ),
    'plugins' => $plugins
);
