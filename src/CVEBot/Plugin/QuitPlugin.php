<?php

namespace CVEBot\Plugin;

use Phergie\Irc\Event\EventInterface as Event;
use Phergie\Irc\Bot\React\EventQueueInterface as Queue;
use Phergie\Irc\Bot\React\PluginInterface;

class QuitPlugin implements PluginInterface {
    public function getSubscribedEvents() {
        return array(
            'irc.received.privmsg' => 'onPrivmsg'
        );
    }

    public function onPrivmsg(Event $event, Queue $queue) {
        $source = $event->getSource();
        $params = $event->getParams();

        $isQuitCommand = preg_match('/^!quit$/', $params['text']) === 1;
        $isAdmin = $source === 'case_';
        
        if ($isQuitCommand && $isAdmin) {
            $queue->ircPrivmsg($source, 'Bye!');
            $queue->ircQuit('Shutting down...');
        }
    }
}
