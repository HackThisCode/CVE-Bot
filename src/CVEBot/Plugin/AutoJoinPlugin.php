<?php

namespace CVEBot\Plugin;

require_once __DIR__ . '/../Config.php';

use Phergie\Irc\Event\EventInterface as Event;
use Phergie\Irc\Bot\React\EventQueueInterface as Queue;
use Phergie\Irc\Bot\React\PluginInterface;

class AutoJoinPlugin implements PluginInterface {
    public function getSubscribedEvents() {
        return array(
            'irc.received.rpl_endofmotd' => 'onMotdEnd'
        );
    }

    public function onMotdEnd(Event $event, Queue $queue) {
        $config = \CVEBot\Config::getInstance()->getData();
        $channels = explode(',', $config['irc']['channels']);

        array_walk($channels, function ($channel) use ($queue) {
            $queue->ircJoin($channel);
        });
    }
}
